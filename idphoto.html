<!DOCTYPE html>
<html>
<head>
  <title>User Photo Redirection</title>
  <style>
    /* CSS for styling the search box and buttons */
    #searchBox {
      margin-right: 10px;
      padding: 10px;
      border: none;
      border-bottom: 2px solid #ccc;
      outline: none;
      /* Add animation properties */
      transition: border-color 0.3s ease-in-out;
    }

    #redirectBtn {
      cursor: pointer;
      padding: 10px;
      background-color: #007bff;
      color: #fff;
      border: none;
      /* Add animation properties */
      transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
    }

    #downloadBtn {
      cursor: pointer;
      padding: 10px;
      background-color: #28a745;
      color: #fff;
      border: none;
      /* Add animation properties */
      transition: background-color 0.3s ease-in-out, transform 0.3s ease-in-out;
    }

    /* CSS for animations on search box focus */
    #searchBox:focus {
      border-color: #007bff;
    }

    /* CSS for animations on button hover */
    #redirectBtn:hover, #downloadBtn:hover {
      background-color: #0056b3;
      transform: scale(1.05);
    }

    /* CSS for animations on button click */
    #redirectBtn:active, #downloadBtn:active {
      background-color: #003982;
      transform: scale(0.95);
    }

    /* CSS for table formatting */
    #photoTable {
      border-collapse: collapse;
      width: 100%;
      max-width: 800px;
      margin-top: 20px;
      margin-bottom: 20px;
    }

    #photoTable th,
    #photoTable td {
      border: 2px solid #000;
      padding: 8px;
      text-align: left;
    }

    #photoTable th {
      background-color: #f2f2f2;
    }
  </style>

<body>
  <center>
  <h1>User Photo Redirection</h1>
  <input type="text" id="searchBox" placeholder="Enter Prefix (e.g. N19)">
  <button id="redirectBtn">Go</button>
  <button id="downloadBtn">Download</button>
  <table id="photoTable">
    <!-- Table rows will be dynamically generated here -->
  </table>
  <script>
    // JavaScript code for redirection
    document.getElementById("redirectBtn").onclick = function() {
      // Get the input value from the search box
      var input = document.getElementById("searchBox").value;

      // Extract the prefix and convert it to uppercase
      var prefix = input.toUpperCase();

      // Get the table element
      var table = document.getElementById("photoTable");

      // Clear existing rows from the table
      table.innerHTML = "";

      // Loop through the input range and generate table rows
      for (var i = 1; i <= 1200; i++) {
        // Convert the current number to a string and pad it with leading zeros to have a fixed length of 4 digits
        var userID = prefix + String(i).padStart(4, "0");

        // Construct the URL with the extracted user ID
        var url = "https://intranet.rguktn.ac.in/SMS/usrphotos/user/" + userID + ".jpg";

        // Create a new row in the table
        var row = table.insertRow();

        // Insert cells for ID and Photo in the row
        var idCell = row.insertCell(0);
        var photoCell = row.insertCell(1);

        // Set the text content of the cells
        idCell.textContent = userID;

        // Create an image element
        var img = document.createElement('img');

        // Set the image source
        img.src = url;
        img.width = 100;
        img.height = 100;

        // Check if the photo is valid
        img.onerror = function() {
          // Remove the row if photo is not found
          row.remove();
        };

        // Append the image element to the photo cell
        photoCell.appendChild(img);
      }
    };

    // Handle download button click
document.getElementById("downloadBtn").onclick = function() {
  // Get all the table data elements
  var tableData = document.getElementsByTagName("td");

  // Create an array to hold the user IDs
  var userIDs = [];

  // Loop through the table data elements and extract the user IDs
  for (var i = 0; i < tableData.length; i++) {
    userIDs.push(tableData[i].textContent);
  }

  // Create a JSON object with the user IDs
  var json = JSON.stringify({ userIDs: userIDs });

  // Create a Blob object with the JSON data
  var blob = new Blob([json], { type: "application/json" });

  // Create a download link element
  var downloadLink = document.createElement("a");

  // Set the download link properties
  downloadLink.href = URL.createObjectURL(blob);
  downloadLink.download = "user_photos.json";

  // Append the download link to the document and click it to trigger the download
  document.body.appendChild(downloadLink);
  downloadLink.click();

  // Remove the download link from the document
  document.body.removeChild(downloadLink);
};
  </script>
</center>
</body>
</html>
